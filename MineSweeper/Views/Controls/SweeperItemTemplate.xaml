<?xml version="1.0" encoding="utf-8"?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:MineSweeper.Views.Converters"
             xmlns:models="clr-namespace:MineSweeper.Models"
             x:Class="MineSweeper.Views.Controls.SweeperItemTemplate"
             x:DataType="models:SweeperItem">
    <ContentView.Resources>
        <ResourceDictionary>
            <!-- Optimized converters -->
            <converters:SimpleRevealedConverter x:Key="SimpleRevealedConverter" />
            <converters:BoolToOpacityConverter x:Key="BoolToOpacityConverter" />
            <converters:InverseBoolToOpacityConverter x:Key="InverseBoolToOpacityConverter" />
            <converters:MineCountToColorConverter x:Key="MineCountToColorConverter" />
            <converters:NonZeroConverter x:Key="NonZeroConverter" />
            
            <!-- Colors for different mine counts (used by MineCountToColorConverter) -->
            <Color x:Key="MineCount1Color">Blue</Color>
            <Color x:Key="MineCount2Color">Green</Color>
            <Color x:Key="MineCount3Color">Red</Color>
            <Color x:Key="MineCount4Color">DarkBlue</Color>
            <Color x:Key="MineCount5Color">DarkRed</Color>
            <Color x:Key="MineCount6Color">Teal</Color>
            <Color x:Key="MineCount7Color">Black</Color>
            <Color x:Key="MineCount8Color">Gray</Color>
        </ResourceDictionary>
    </ContentView.Resources>
    
    <!-- Simplified cell template using Frame instead of Border with Shadow -->
    <Frame BackgroundColor="{Binding IsRevealed, Converter={StaticResource SimpleRevealedConverter}}"
           BorderColor="{AppThemeBinding Light={StaticResource CellBorder}, Dark={StaticResource CellBorderDark}}"
           CornerRadius="2"
           Padding="0"
           Margin="0"
           HasShadow="False"
           HorizontalOptions="Fill"
           VerticalOptions="Fill">
        
        <Grid>
            <!-- Flag emoji (when flagged and not revealed) -->
            <Label Text="ðŸš©" 
                   HorizontalOptions="Center" 
                   VerticalOptions="Center" 
                   FontSize="16"
                   TextColor="{StaticResource FlagColor}"
                   IsVisible="{Binding IsFlagged}"
                   Opacity="{Binding IsRevealed, Converter={StaticResource InverseBoolToOpacityConverter}}" />
            
            <!-- Mine emoji (when revealed and is mine) -->
            <Label Text="ðŸ’£" 
                   HorizontalOptions="Center" 
                   VerticalOptions="Center" 
                   FontSize="16"
                   TextColor="{StaticResource MineColor}"
                   IsVisible="{Binding IsMine}"
                   Opacity="{Binding IsRevealed, Converter={StaticResource BoolToOpacityConverter}}" />
            
            <!-- Mine count (when revealed, not a mine, and count > 0) -->
            <Label Text="{Binding MineCount}" 
                   TextColor="{Binding MineCount, Converter={StaticResource MineCountToColorConverter}}"
                   HorizontalOptions="Center" 
                   VerticalOptions="Center" 
                   FontSize="14"
                   FontAttributes="Bold"
                   IsVisible="{Binding MineCount, Converter={StaticResource NonZeroConverter}}"
                   Opacity="{Binding IsRevealed, Converter={StaticResource BoolToOpacityConverter}}" />
        </Grid>
    </Frame>
</ContentView>
